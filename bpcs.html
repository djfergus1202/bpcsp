<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PharmaSim Pro - Integrated Pharmaceutical Research & Publication Platform</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 50%, #7e8ba3 100%);
            color: #333;
            min-height: 100vh;
            padding: 0;
        }
        
        .header {
            background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(240,248,255,0.98) 100%);
            backdrop-filter: blur(10px);
            padding: 20px 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        
        .header h1 {
            font-size: 2.2em;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }
        
        .header-subtitle {
            color: #666;
            font-size: 1em;
            margin-bottom: 5px;
        }
        
        .attribution {
            font-size: 0.85em;
            color: #888;
            font-style: italic;
        }
        
        .attribution a {
            color: #2a5298;
            text-decoration: none;
        }
        
        .attribution a:hover {
            text-decoration: underline;
        }
        
        .disclaimer-banner {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border: 2px solid #ff9800;
            border-radius: 12px;
            padding: 15px 20px;
            margin: 20px 40px;
            box-shadow: 0 4px 15px rgba(255,152,0,0.2);
        }
        
        .disclaimer-banner h4 {
            color: #e65100;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .disclaimer-banner h4::before {
            content: '⚠️';
            font-size: 1.2em;
        }
        
        .disclaimer-banner p {
            color: #5d4037;
            line-height: 1.6;
            font-size: 14px;
        }
        
        .disclaimer-banner .github-link {
            color: #e65100;
            font-weight: 600;
            text-decoration: none;
        }
        
        .disclaimer-banner .github-link:hover {
            text-decoration: underline;
        }
        
        .nav-tabs {
            display: flex;
            gap: 15px;
            margin-top: 15px;
            border-bottom: 2px solid rgba(30,60,114,0.1);
            padding-bottom: 10px;
            flex-wrap: wrap;
        }
        
        .nav-tab {
            padding: 10px 20px;
            background: white;
            color: #2a5298;
            border: 2px solid #2a5298;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .nav-tab:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(42,82,152,0.3);
        }
        
        .nav-tab.active {
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            color: white;
            border-color: transparent;
        }
        
        .nav-tab.new-feature {
            position: relative;
        }
        
        .nav-tab.new-feature::after {
            content: 'NEW';
            position: absolute;
            top: -5px;
            right: -5px;
            background: #f44336;
            color: white;
            font-size: 9px;
            padding: 2px 6px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .tooltip {
            position: absolute;
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 5px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
            top: -40px;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .nav-tab:hover .tooltip {
            opacity: 1;
        }
        
        .main-container {
            max-width: 1600px;
            margin: 30px auto;
            padding: 0 20px;
        }
        
        .module-section {
            display: none;
        }
        
        .module-section.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: 320px 1fr;
            gap: 25px;
        }
        
        .control-panel {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            height: fit-content;
            position: sticky;
            top: 180px;
        }
        
        .control-panel h2 {
            color: #1e3c72;
            font-size: 1.3em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(30,60,114,0.1);
        }
        
        .help-icon {
            display: inline-block;
            width: 18px;
            height: 18px;
            background: #2a5298;
            color: white;
            text-align: center;
            line-height: 18px;
            border-radius: 50%;
            font-size: 11px;
            margin-left: 8px;
            cursor: help;
            vertical-align: middle;
        }
        
        .help-text {
            position: absolute;
            background: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 12px;
            font-size: 13px;
            line-height: 1.5;
            width: 250px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1000;
            display: none;
        }
        
        .help-icon:hover + .help-text {
            display: block;
        }
        
        .control-group {
            margin-bottom: 18px;
            position: relative;
        }
        
        .control-group label {
            display: flex;
            align-items: center;
            margin-bottom: 8px;
            color: #555;
            font-weight: 600;
            font-size: 14px;
        }
        
        .control-group input[type="number"],
        .control-group input[type="text"],
        .control-group input[type="file"],
        .control-group textarea,
        .control-group select {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e6ed;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s ease;
            background: #f8f9fa;
            font-family: inherit;
        }
        
        .control-group textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        .control-group input:focus,
        .control-group select:focus,
        .control-group textarea:focus {
            outline: none;
            border-color: #2a5298;
            background: white;
            box-shadow: 0 0 0 3px rgba(42,82,152,0.1);
        }
        
        .control-group input[type="range"] {
            width: 100%;
            margin-bottom: 5px;
        }
        
        .value-display {
            font-size: 12px;
            color: #777;
            text-align: right;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        button {
            flex: 1;
            padding: 12px 18px;
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(42,82,152,0.3);
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(42,82,152,0.4);
        }
        
        button.secondary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        button.danger {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        button.success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        button.publish {
            background: linear-gradient(135deg, #00c853 0%, #4caf50 100%);
        }
        
        .visualization-area {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 25px;
        }
        
        .chart-container {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            min-height: 400px;
            position: relative;
        }
        
        .chart-container h3 {
            color: #1e3c72;
            font-size: 1.2em;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(30,60,114,0.1);
        }
        
        .results-panel {
            background: rgba(255,255,255,0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 25px;
            margin-top: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        
        .results-panel h3 {
            color: #1e3c72;
            font-size: 1.3em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(30,60,114,0.1);
        }
        
        .metric-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
        }
        
        .metric-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 15px;
            border: 1px solid rgba(30,60,114,0.1);
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
        }
        
        .metric-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }
        
        .metric-value {
            font-size: 1.8em;
            font-weight: bold;
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .info-box {
            background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
            border-left: 4px solid #2a5298;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }
        
        .info-box h4 {
            color: #1e3c72;
            margin-bottom: 8px;
            font-size: 1.1em;
        }
        
        .info-box p {
            color: #555;
            line-height: 1.6;
            font-size: 14px;
        }
        
        .tab-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding: 10px;
            background: rgba(30,60,114,0.05);
            border-radius: 10px;
        }
        
        .tab-button {
            padding: 8px 16px;
            background: white;
            color: #2a5298;
            border: 1px solid #2a5298;
            border-radius: 20px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .tab-button.active {
            background: #2a5298;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        canvas, #molecularDisplay {
            width: 100% !important;
            height: 350px !important;
            border-radius: 10px;
        }
        
        #molecularDisplay {
            position: relative;
            background-color: #f0f0f0;
        }
        
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        
        .loading-spinner {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #2a5298;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .educational-tip {
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            border-left: 4px solid #ff9800;
            padding: 12px;
            margin: 15px 0;
            border-radius: 8px;
            font-size: 13px;
            color: #5d4037;
        }
        
        .educational-tip strong {
            color: #e65100;
        }
        
        /* Blog/Publication Styles */
        .blog-post-form {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
        }
        
        .blog-post-form h3 {
            color: #1e3c72;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(30,60,114,0.1);
        }
        
        .template-box {
            background: #f8f9fa;
            border: 2px dashed #2a5298;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.8;
        }
        
        .template-variable {
            color: #e65100;
            font-weight: bold;
        }
        
        .blog-preview {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .blog-post-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }
        
        .blog-post-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
        }
        
        .blog-post-title {
            color: #1e3c72;
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        
        .blog-post-meta {
            color: #888;
            font-size: 0.9em;
            margin-bottom: 15px;
        }
        
        .blog-post-content {
            color: #333;
            line-height: 1.8;
        }
        
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        
        .data-table th {
            background: #2a5298;
            color: white;
            padding: 12px;
            text-align: left;
        }
        
        .data-table td {
            padding: 10px 12px;
            border-bottom: 1px solid #ddd;
        }
        
        .data-table tr:hover {
            background: #f5f5f5;
        }
        
        .capture-button {
            position: absolute;
            top: 20px;
            right: 20px;
            padding: 8px 15px;
            background: #4caf50;
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .capture-button:hover {
            background: #45a049;
            transform: scale(1.05);
        }
        
        .footer {
            background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(240,248,255,0.98) 100%);
            padding: 30px 40px;
            margin-top: 50px;
            text-align: center;
            border-top: 2px solid rgba(30,60,114,0.1);
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .footer-attribution {
            color: #666;
            font-size: 14px;
            line-height: 1.8;
        }
        
        .footer-links {
            margin-top: 15px;
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }
        
        .footer-links a {
            color: #2a5298;
            text-decoration: none;
            font-weight: 600;
            transition: color 0.3s ease;
        }
        
        .footer-links a:hover {
            color: #1e3c72;
            text-decoration: underline;
        }
        
        @media (max-width: 968px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            .control-panel {
                position: relative;
                top: 0;
            }
            .visualization-area {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/3Dmol/2.0.4/3Dmol-min.js"></script>
    <script src="https://unpkg.com/@rdkit/rdkit/dist/RDKit_minimal.js"></script>
</head>
<body>
    <div class="header">
        <h1>PharmaSim Pro</h1>
        <p class="header-subtitle">Integrated Pharmaceutical Research & Publication Platform</p>
        <p class="attribution">Created by <strong>David Ferguson, BS, MS, Pharm.D. Candidate</strong> | Powered by <a href="https://www.anthropic.com" target="_blank">Anthropic Claude AI</a></p>
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchModule('pbpk')">
                PBPK/QSP Modeling
                <span class="tooltip">Physiologically-based pharmacokinetic modeling</span>
            </button>
            <button class="nav-tab" onclick="switchModule('clinical')">
                Clinical Trial Design
                <span class="tooltip">Bayesian adaptive trial simulation</span>
            </button>
            <button class="nav-tab" onclick="switchModule('molecular')">
                Molecular Dynamics
                <span class="tooltip">Protein and ligand interactions</span>
            </button>
            <button class="nav-tab new-feature" onclick="switchModule('publications')">
                Research Publications
                <span class="tooltip">Share your findings</span>
            </button>
            <button class="nav-tab" onclick="switchModule('tutorial')">
                Learning Center
                <span class="tooltip">Interactive tutorials and guides</span>
            </button>
        </div>
    </div>
    
    <div class="disclaimer-banner">
        <h4>Important Research Disclaimer</h4>
        <p>
            <strong>These computational models provide approximations for educational and exploratory purposes only.</strong> 
            All values generated represent theoretical estimates based on simplified mathematical models. 
            Results must be validated through proper in vitro, in vivo, and additional in silico studies before any critical decisions. 
            Models are inherently limited and can produce errors—always double-check calculations and consult with qualified professionals. 
            <br><br>
            <strong>Never use these simulations as the sole basis for clinical or research decisions.</strong>
            <br>
            Source code available on <a href="https://github.com/pharmasim-pro" class="github-link" target="_blank">GitHub</a> for transparency and peer review.
        </p>
    </div>
    
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Running simulation...</p>
        </div>
    </div>
    
    <div class="main-container">
        <!-- PBPK/QSP Module -->
        <div class="module-section active" id="pbpk-module">
            <div class="dashboard-grid">
                <div class="control-panel">
                    <h2>PBPK/QSP Parameters</h2>
                    <button class="capture-button" onclick="captureResults('pbpk')">📊 Capture for Publication</button>
                    
                    <div class="tab-buttons">
                        <button class="tab-button active" onclick="switchTab('absorption', 'pbpk')">Absorption</button>
                        <button class="tab-button" onclick="switchTab('distribution', 'pbpk')">Distribution</button>
                        <button class="tab-button" onclick="switchTab('metabolism', 'pbpk')">Metabolism</button>
                        <button class="tab-button" onclick="switchTab('qsp', 'pbpk')">QSP</button>
                    </div>
                    
                    <div class="tab-content active" id="absorption-tab">
                        <div class="control-group">
                            <label>Drug Name/ID</label>
                            <input type="text" id="drug-name" placeholder="e.g., Aspirin, Drug X">
                        </div>
                        <div class="control-group">
                            <label>
                                Dose (mg)
                                <span class="help-icon">?</span>
                                <div class="help-text">
                                    Amount of drug administered. Higher doses lead to proportionally higher concentrations.
                                </div>
                            </label>
                            <input type="number" id="dose" value="100" min="1" max="1000" step="10">
                            <div class="value-display">100 mg dose</div>
                        </div>
                        <div class="control-group">
                            <label>
                                Bioavailability (F)
                                <span class="help-icon">?</span>
                                <div class="help-text">
                                    The fraction of drug that reaches systemic circulation unchanged. 
                                    Oral drugs typically range from 5-100%.
                                </div>
                            </label>
                            <input type="number" id="bioavailability" value="80" min="0" max="100" step="5">
                            <div class="value-display">80% reaches systemic circulation</div>
                        </div>
                        <div class="control-group">
                            <label>
                                Absorption Rate (ka)
                                <span class="help-icon">?</span>
                                <div class="help-text">
                                    First-order absorption rate constant. Higher values = faster absorption.
                                    Typical range: 0.5-3.0 h⁻¹
                                </div>
                            </label>
                            <input type="number" id="ka" value="1.5" step="0.1" min="0.1" max="5">
                            <div class="value-display">1.5 h⁻¹</div>
                        </div>
                        <div class="control-group">
                            <label>
                                Formulation
                                <span class="help-icon">?</span>
                                <div class="help-text">
                                    Different formulations affect drug release and absorption patterns
                                </div>
                            </label>
                            <select id="formulation">
                                <option value="immediate">Immediate Release</option>
                                <option value="extended">Extended Release</option>
                                <option value="enteric">Enteric Coated</option>
                                <option value="sublingual">Sublingual</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="distribution-tab">
                        <div class="control-group">
                            <label>
                                Molecular Weight (Da)
                                <span class="help-icon">?</span>
                                <div class="help-text">
                                    Affects tissue penetration. Large molecules (>500 Da) have limited distribution.
                                </div>
                            </label>
                            <input type="number" id="mw" value="350" step="10" min="100" max="2000">
                            <div class="value-display">350 Da</div>
                        </div>
                        <div class="control-group">
                            <label>
                                Volume of Distribution (Vd)
                                <span class="help-icon">?</span>
                                <div class="help-text">
                                    Apparent volume the drug distributes into. Large Vd = extensive tissue distribution.
                                    Water-soluble drugs: ~40L, Lipophilic drugs: >100L
                                </div>
                            </label>
                            <input type="number" id="vd" value="70" step="5" min="10" max="500">
                            <div class="value-display">70 L</div>
                        </div>
                        <div class="control-group">
                            <label>
                                Plasma Protein Binding
                                <span class="help-icon">?</span>
                                <div class="help-text">
                                    Percentage bound to plasma proteins (mainly albumin).
                                    Only unbound drug is pharmacologically active.
                                </div>
                            </label>
                            <input type="number" id="protein-binding" value="90" min="0" max="99" step="1">
                            <div class="value-display">90% bound, 10% free</div>
                        </div>
                        <div class="control-group">
                            <label>
                                LogP (Lipophilicity)
                                <span class="help-icon">?</span>
                                <div class="help-text">
                                    Partition coefficient - measure of lipophilicity.
                                    LogP < 0: Hydrophilic, LogP 1-3: Drug-like, LogP > 5: Very lipophilic
                                </div>
                            </label>
                            <input type="number" id="logp" value="2.5" step="0.1" min="-2" max="8">
                            <div class="value-display">2.5 (moderately lipophilic)</div>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="metabolism-tab">
                        <div class="control-group">
                            <label>
                                Clearance (CL)
                                <span class="help-icon">?</span>
                                <div class="help-text">
                                    Volume of plasma cleared of drug per unit time.
                                    Hepatic CL typically 0.5-2.0 L/h for most drugs
                                </div>
                            </label>
                            <input type="number" id="clearance" value="1.2" step="0.1">
                            <div class="value-display">1.2 L/h</div>
                        </div>
                        <div class="control-group">
                            <label>
                                Primary Enzyme
                                <span class="help-icon">?</span>
                                <div class="help-text">
                                    CYP450 enzymes metabolize ~75% of all drugs.
                                    Important for drug-drug interactions.
                                </div>
                            </label>
                            <select id="enzyme">
                                <option value="cyp3a4">CYP3A4 (50% of drugs)</option>
                                <option value="cyp2d6">CYP2D6 (25% of drugs)</option>
                                <option value="cyp2c9">CYP2C9 (15% of drugs)</option>
                                <option value="cyp1a2">CYP1A2</option>
                                <option value="cyp2c19">CYP2C19</option>
                                <option value="ugt">UGT (Glucuronidation)</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>
                                Renal Function
                                <span class="help-icon">?</span>
                                <div class="help-text">
                                    Creatinine clearance affects renal drug elimination.
                                    Normal: 90-120 mL/min
                                </div>
                            </label>
                            <select id="renal-function">
                                <option value="normal">Normal (CrCl > 90)</option>
                                <option value="mild">Mild Impairment (60-90)</option>
                                <option value="moderate">Moderate (30-60)</option>
                                <option value="severe">Severe (15-30)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="qsp-tab">
                        <div class="control-group">
                            <label>Target Protein</label>
                            <input type="text" id="target-protein" placeholder="e.g., ACE2, EGFR, COX-2">
                        </div>
                        <div class="control-group">
                            <label>
                                Target Receptor Type
                                <span class="help-icon">?</span>
                                <div class="help-text">
                                    The biological target the drug binds to
                                </div>
                            </label>
                            <select id="target-receptor">
                                <option value="gpcr">GPCR (40% of drugs)</option>
                                <option value="kinase">Kinase</option>
                                <option value="nuclear">Nuclear Receptor</option>
                                <option value="ion-channel">Ion Channel</option>
                                <option value="enzyme">Enzyme</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>
                                EC50 (nM)
                                <span class="help-icon">?</span>
                                <div class="help-text">
                                    Concentration producing 50% of maximum effect.
                                    Lower EC50 = more potent drug
                                </div>
                            </label>
                            <input type="number" id="ec50" value="50" step="5">
                        </div>
                        <div class="control-group">
                            <label>
                                Hill Coefficient
                                <span class="help-icon">?</span>
                                <div class="help-text">
                                    Steepness of dose-response curve.
                                    n=1: Simple binding, n>1: Cooperative binding
                                </div>
                            </label>
                            <input type="number" id="hill" value="1.5" step="0.1">
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <button onclick="runPBPKSimulation()">Run PBPK Simulation</button>
                        <button class="secondary" onclick="loadPreset('pbpk')">Random Example</button>
                    </div>
                    
                    <div class="info-box" style="margin-top: 15px;">
                        <h4>🎯 Quick Drug Comparisons</h4>
                        <p style="margin-bottom: 10px;">Try these different drug types to see how parameters affect PK:</p>
                        <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                            <button onclick="loadSpecificDrug('hydrophilic')" style="flex: 1; padding: 8px; font-size: 12px;">Hydrophilic</button>
                            <button onclick="loadSpecificDrug('lipophilic')" style="flex: 1; padding: 8px; font-size: 12px;">Lipophilic</button>
                            <button onclick="loadSpecificDrug('high-clearance')" style="flex: 1; padding: 8px; font-size: 12px;">High Clearance</button>
                        </div>
                    </div>
                    
                    <div class="educational-tip">
                        <strong>💡 Learning Tip:</strong> Each drug type shows dramatically different PK profiles. Compare a hydrophilic vs lipophilic drug to see how LogP affects tissue distribution!
                    </div>
                </div>
                
                <div class="visualization-area">
                    <div class="chart-container">
                        <h3>Plasma Concentration Profile</h3>
                        <canvas id="pkChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <h3>Target Occupancy</h3>
                        <canvas id="qspChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <h3>Tissue Distribution</h3>
                        <canvas id="tissueChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <h3>Drug-Drug Interactions</h3>
                        <canvas id="ddiChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="results-panel">
                <h3>Pharmacokinetic Parameters</h3>
                <div class="metric-grid">
                    <div class="metric-card">
                        <div class="metric-label">Cmax</div>
                        <div class="metric-value" id="cmax">--</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Tmax</div>
                        <div class="metric-value" id="tmax">--</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">AUC₀₋∞</div>
                        <div class="metric-value" id="auc">--</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Half-life</div>
                        <div class="metric-value" id="halflife">--</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Clearance</div>
                        <div class="metric-value" id="cl-calc">--</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Vss</div>
                        <div class="metric-value" id="vss">--</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Clinical Trial Module -->
        <div class="module-section" id="clinical-module">
            <div class="dashboard-grid">
                <div class="control-panel">
                    <h2>Clinical Trial Design</h2>
                    <button class="capture-button" onclick="captureResults('clinical')">📊 Capture for Publication</button>
                    
                    <div class="info-box">
                        <h4>Phase 1 Trial Objectives</h4>
                        <p>Determine the maximum tolerated dose (MTD) and recommended phase 2 dose (RP2D) while minimizing patient exposure to toxic doses.</p>
                    </div>
                    
                    <div class="control-group">
                        <label>Study Drug Name</label>
                        <input type="text" id="study-drug-name" placeholder="e.g., Novel Kinase Inhibitor X">
                    </div>
                    
                    <div class="control-group">
                        <label>
                            Design Type
                            <span class="help-icon">?</span>
                            <div class="help-text">
                                Choose between traditional and modern Bayesian adaptive designs
                            </div>
                        </label>
                        <select id="design-type" onchange="updateDesignInfo()">
                            <option value="3plus3">3+3 Traditional</option>
                            <option value="crm">CRM - Continual Reassessment</option>
                            <option value="boin">BOIN - Bayesian Optimal Interval</option>
                            <option value="ewoc">EWOC - Escalation with Overdose Control</option>
                            <option value="blrm">BLRM - Bayesian Logistic Regression</option>
                            <option value="mTPI">mTPI - Modified Toxicity Probability Interval</option>
                        </select>
                    </div>
                    
                    <div id="design-info" class="info-box" style="margin-top: 15px;">
                        <h4>3+3 Design</h4>
                        <p>Traditional rule-based design. Simple but inefficient. Treats 3 patients per dose, escalates if 0/3 DLTs, expands to 6 if 1/3 DLTs.</p>
                    </div>
                    
                    <div class="control-group">
                        <label>
                            Target DLT Rate
                            <span class="help-icon">?</span>
                            <div class="help-text">
                                Acceptable dose-limiting toxicity rate. Usually 20-33% for oncology trials
                            </div>
                        </label>
                        <input type="number" id="target-tox" value="0.25" min="0.1" max="0.4" step="0.05">
                        <div class="value-display">25% target toxicity</div>
                    </div>
                    
                    <div class="control-group">
                        <label>
                            Starting Dose (mg)
                            <span class="help-icon">?</span>
                            <div class="help-text">
                                Usually 1/10th of the dose that causes severe toxicity in 10% of animals (MABEL approach)
                            </div>
                        </label>
                        <input type="number" id="start-dose" value="10" step="5">
                    </div>
                    
                    <div class="control-group">
                        <label>
                            Maximum Dose (mg)
                            <span class="help-icon">?</span>
                            <div class="help-text">
                                Safety ceiling based on preclinical data
                            </div>
                        </label>
                        <input type="number" id="max-dose" value="200" step="10">
                    </div>
                    
                    <div class="control-group">
                        <label>
                            Dose Escalation Scheme
                            <span class="help-icon">?</span>
                            <div class="help-text">
                                How doses increase between cohorts
                            </div>
                        </label>
                        <select id="escalation-scheme">
                            <option value="fibonacci">Modified Fibonacci (67%, 50%, 40%, 33%...)</option>
                            <option value="doubling">Doubling (100% increases)</option>
                            <option value="pharmacologic">Pharmacologically-guided</option>
                            <option value="custom">Custom</option>
                        </select>
                    </div>
                    
                    <div class="control-group">
                        <label>Number of Dose Levels</label>
                        <input type="number" id="cohorts" value="6" min="3" max="10">
                    </div>
                    
                    <div class="control-group">
                        <label>Cohort Size</label>
                        <input type="number" id="cohort-size" value="3" min="1" max="6">
                    </div>
                    
                    <div class="button-group">
                        <button onclick="runTrialSimulation()">Run Single Trial</button>
                        <button class="secondary" onclick="runMonteCarloTrials()">Run 1000 Trials</button>
                        <button class="success" onclick="compareDesigns()">Compare All Designs</button>
                    </div>
                    
                    <div class="educational-tip">
                        <strong>💡 Learning Tip:</strong> Modern Bayesian designs (CRM, BOIN) typically find the MTD with fewer patients than the traditional 3+3 design. Run the comparison to see the differences!
                    </div>
                </div>
                
                <div class="visualization-area">
                    <div class="chart-container">
                        <h3>Dose Escalation Progress</h3>
                        <canvas id="trialChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <h3>Dose-Toxicity Curve</h3>
                        <canvas id="toxicityChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <h3>Design Performance Comparison</h3>
                        <canvas id="comparisonChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <h3>Operating Characteristics</h3>
                        <canvas id="ocChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="results-panel">
                <h3>Trial Results</h3>
                <div class="metric-grid">
                    <div class="metric-card">
                        <div class="metric-label">MTD Estimate</div>
                        <div class="metric-value" id="mtd">--</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">RP2D</div>
                        <div class="metric-value" id="rp2d">--</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">DLT Rate at MTD</div>
                        <div class="metric-value" id="dlt-rate">--</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Total Patients</div>
                        <div class="metric-value" id="total-patients">--</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Patients with DLT</div>
                        <div class="metric-value" id="patients-dlt">--</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Trial Duration</div>
                        <div class="metric-value" id="trial-duration">--</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Molecular Dynamics Module -->
        <div class="module-section" id="molecular-module">
            <div class="dashboard-grid">
                <div class="control-panel">
                    <h2>Molecular Simulations</h2>
                    <button class="capture-button" onclick="captureResults('molecular')">📊 Capture for Publication</button>
                    
                    <div class="tab-buttons">
                        <button class="tab-button active" onclick="switchTab('structure', 'molecular')">Structure</button>
                        <button class="tab-button" onclick="switchTab('dynamics', 'molecular')">Dynamics</button>
                        <button class="tab-button" onclick="switchTab('binding', 'molecular')">Binding</button>
                    </div>
                    
                    <div class="tab-content active" id="structure-tab">
                        <div class="control-group">
                            <label>
                                Load PDB Structure
                                <span class="help-icon">?</span>
                                <div class="help-text">
                                    Upload a Protein Data Bank file to visualize molecular structure
                                </div>
                            </label>
                            <input type="file" id="pdbFile" accept=".pdb">
                        </div>
                        <div class="control-group">
                            <label>
                                Or Enter Drug SMILES
                                <span class="help-icon">?</span>
                                <div class="help-text">
                                    Simplified molecular-input line-entry system notation
                                </div>
                            </label>
                            <input type="text" id="smilesInput" placeholder="e.g., CC(=O)OC1=CC=CC=C1C(=O)O for Aspirin">
                        </div>
                        <button onclick="loadMolecularStructure()">Load Structure</button>
                        
                        <div class="educational-tip">
                            <strong>Example SMILES:</strong><br>
                            • Aspirin: CC(=O)OC1=CC=CC=C1C(=O)O<br>
                            • Caffeine: CN1C=NC2=C1C(=O)N(C(=O)N2)C<br>
                            • Ibuprofen: CC(C)CC1=CC=C(C=C1)C(C)C(=O)O
                        </div>
                    </div>
                    
                    <div class="tab-content" id="dynamics-tab">
                        <div class="control-group">
                            <label>
                                Simulation Type
                                <span class="help-icon">?</span>
                                <div class="help-text">
                                    Different molecular simulation methods
                                </div>
                            </label>
                            <select id="sim-type">
                                <option value="md">Molecular Dynamics</option>
                                <option value="mc">Monte Carlo</option>
                                <option value="docking">Molecular Docking</option>
                                <option value="qm">Quantum Mechanics</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Temperature (K)</label>
                            <input type="range" id="mdTemp" min="100" max="500" value="300">
                            <div class="value-display"><span id="mdTempValue">300</span> K (27°C)</div>
                        </div>
                        <div class="control-group">
                            <label>Force Field</label>
                            <select id="forceField">
                                <option value="amber">AMBER (proteins)</option>
                                <option value="charmm">CHARMM (biomolecules)</option>
                                <option value="opls">OPLS (organic molecules)</option>
                                <option value="gromos">GROMOS (united atom)</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="tab-content" id="binding-tab">
                        <div class="control-group">
                            <label>
                                Binding Site
                                <span class="help-icon">?</span>
                                <div class="help-text">
                                    Active site or allosteric binding location
                                </div>
                            </label>
                            <select id="binding-site">
                                <option value="active">Active Site</option>
                                <option value="allosteric">Allosteric Site</option>
                                <option value="interface">Protein-Protein Interface</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Docking Algorithm</label>
                            <select id="docking-algorithm">
                                <option value="rigid">Rigid Docking</option>
                                <option value="flexible">Flexible Docking</option>
                                <option value="ensemble">Ensemble Docking</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label>Scoring Function</label>
                            <select id="scoring">
                                <option value="empirical">Empirical</option>
                                <option value="knowledge">Knowledge-based</option>
                                <option value="force">Force Field</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="button-group">
                        <button onclick="startMolecularSimulation()">Start Simulation</button>
                        <button class="danger" onclick="stopMolecularSimulation()">Stop</button>
                        <button class="secondary" onclick="exportMolecularData()">Export Data</button>
                    </div>
                </div>
                
                <div class="visualization-area">
                    <div class="chart-container">
                        <h3>3D Molecular Structure</h3>
                        <div id="molecularDisplay"></div>
                    </div>
                    
                    <div class="chart-container">
                        <h3>Energy Profile</h3>
                        <canvas id="energyChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <h3>RMSD Over Time</h3>
                        <canvas id="rmsdChart"></canvas>
                    </div>
                    
                    <div class="chart-container">
                        <h3>Interaction Analysis</h3>
                        <canvas id="interactionChart"></canvas>
                    </div>
                </div>
            </div>
            
            <div class="results-panel">
                <h3>Simulation Metrics</h3>
                <div class="metric-grid">
                    <div class="metric-card">
                        <div class="metric-label">Total Energy</div>
                        <div class="metric-value" id="total-energy">--</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Binding Affinity</div>
                        <div class="metric-value" id="binding-affinity">--</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">RMSD</div>
                        <div class="metric-value" id="rmsd">--</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">H-Bonds</div>
                        <div class="metric-value" id="hbonds">--</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">Radius of Gyration</div>
                        <div class="metric-value" id="rg">--</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-label">SASA</div>
                        <div class="metric-value" id="sasa">--</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Publications Module -->
        <div class="module-section" id="publications-module">
            <div style="max-width: 1200px; margin: 0 auto;">
                <div class="chart-container">
                    <h3>Research Publication Center</h3>
                    <p style="color: #666; margin-bottom: 20px;">Share your computational findings with the research community</p>
                    
                    <div class="blog-post-form">
                        <h3>Create New Publication</h3>
                        
                        <div class="control-group">
                            <label>Publication Title</label>
                            <input type="text" id="pub-title" placeholder="e.g., In Silico Analysis of Drug X Binding to Protein Y">
                        </div>
                        
                        <div class="control-group">
                            <label>Author(s)</label>
                            <input type="text" id="pub-authors" placeholder="Your name and affiliations">
                        </div>
                        
                        <div class="control-group">
                            <label>Drug/Compound Name</label>
                            <input type="text" id="pub-drug" placeholder="e.g., Novel Kinase Inhibitor X">
                        </div>
                        
                        <div class="control-group">
                            <label>Target Protein</label>
                            <input type="text" id="pub-protein" placeholder="e.g., EGFR, COX-2, ACE2">
                        </div>
                        
                        <div class="control-group">
                            <label>Key Findings</label>
                            <textarea id="pub-findings" placeholder="Describe your main discoveries and their implications..."></textarea>
                        </div>
                        
                        <div class="control-group">
                            <label>Data Values</label>
                            <textarea id="pub-data" placeholder="Include relevant metrics: EC50, Kd, clearance, half-life, etc."></textarea>
                        </div>
                        
                        <div class="control-group">
                            <label>Implications for Early-Stage Scientists</label>
                            <textarea id="pub-implications" placeholder="What does this mean for future research? Suggested next steps?"></textarea>
                        </div>
                        
                        <div class="template-box">
                            <strong>Publication Template:</strong><br><br>
                            <span class="template-variable">[TITLE]</span><br>
                            Authors: <span class="template-variable">[AUTHORS]</span><br>
                            Date: <span class="template-variable">[DATE]</span><br><br>
                            
                            <strong>Abstract:</strong><br>
                            We performed computational modeling of <span class="template-variable">[DRUG NAME]</span> 
                            interaction with <span class="template-variable">[PROTEIN NAME]</span> using PharmaSim Pro 
                            (Ferguson, D.; Anthropic Claude AI).<br><br>
                            
                            <strong>Key Parameters:</strong><br>
                            <span class="template-variable">[DATA VALUES]</span><br><br>
                            
                            <strong>Major Findings:</strong><br>
                            <span class="template-variable">[KEY FINDINGS]</span><br><br>
                            
                            <strong>Implications:</strong><br>
                            <span class="template-variable">[IMPLICATIONS FOR SCIENTISTS]</span><br><br>
                            
                            <strong>Disclaimer:</strong><br>
                            These computational predictions require validation through experimental studies.
                            Values represent theoretical estimates from simplified models.<br><br>
                            
                            <strong>Citation:</strong><br>
                            Created using PharmaSim Pro by David Ferguson (Pharm.D. Candidate) 
                            powered by Anthropic Claude AI. Code available on GitHub.
                        </div>
                        
                        <div class="button-group">
                            <button class="publish" onclick="publishFindings()">Publish Findings</button>
                            <button class="secondary" onclick="previewPublication()">Preview</button>
                            <button onclick="clearPublication()">Clear Form</button>
                        </div>
                    </div>
                    
                    <div id="publication-preview" class="blog-preview" style="display: none;">
                        <!-- Preview will be inserted here -->
                    </div>
                    
                    <div style="margin-top: 40px;">
                        <h3>Recent Publications</h3>
                        <div id="publications-list">
                            <div class="blog-post-card">
                                <h4 class="blog-post-title">Example: PBPK Modeling of Novel JAK Inhibitor</h4>
                                <div class="blog-post-meta">By Research Team A • January 15, 2025</div>
                                <div class="blog-post-content">
                                    Computational analysis revealed favorable pharmacokinetic properties with 
                                    85% bioavailability, 1.2 L/h clearance, and 12-hour half-life. Target 
                                    occupancy reached 90% at steady state. Findings suggest twice-daily dosing 
                                    may be optimal. Further in vitro validation recommended.
                                </div>
                            </div>
                            
                            <div class="blog-post-card">
                                <h4 class="blog-post-title">Example: Bayesian Dose-Finding Simulation for Anti-PD1 Antibody</h4>
                                <div class="blog-post-meta">By Team B • January 10, 2025</div>
                                <div class="blog-post-content">
                                    Compared 6 trial designs for Phase 1 dose escalation. BOIN design showed 
                                    optimal performance with 85% MTD identification rate using 25% fewer patients 
                                    than traditional 3+3. Recommended starting dose: 0.5 mg/kg with escalation 
                                    to 10 mg/kg maximum.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Learning Center -->
        <div class="module-section" id="tutorial-module">
            <div style="max-width: 1200px; margin: 0 auto;">
                <div class="chart-container" style="margin-bottom: 25px;">
                    <h3>Welcome to the Learning Center</h3>
                    <div class="info-box">
                        <h4>Getting Started with PharmaSim Pro</h4>
                        <p>This integrated platform combines three essential areas of pharmaceutical research:</p>
                        <ul style="margin: 15px 0; padding-left: 20px; line-height: 1.8;">
                            <li><strong>PBPK/QSP Modeling:</strong> Understand drug absorption, distribution, metabolism, and excretion</li>
                            <li><strong>Clinical Trial Design:</strong> Learn about adaptive dose-finding methods in Phase 1 trials</li>
                            <li><strong>Molecular Dynamics:</strong> Explore drug-target interactions at the molecular level</li>
                            <li><strong>Research Publications:</strong> Share your findings with the scientific community</li>
                        </ul>
                    </div>
                </div>
                
                <div class="dashboard-grid">
                    <div class="control-panel">
                        <h2>Interactive Tutorials</h2>
                        <div class="button-group" style="flex-direction: column;">
                            <button onclick="startTutorial('pbpk-basics')">PBPK Basics</button>
                            <button onclick="startTutorial('trial-designs')">Understanding Trial Designs</button>
                            <button onclick="startTutorial('molecular-intro')">Molecular Simulations 101</button>
                            <button onclick="startTutorial('publication-guide')">How to Publish Findings</button>
                            <button onclick="startTutorial('case-study')">Complete Case Study</button>
                        </div>
                        
                        <div class="info-box" style="margin-top: 20px;">
                            <h4>Key Concepts</h4>
                            <p>Click on any tutorial to begin an interactive guided walkthrough of that module.</p>
                        </div>
                    </div>
                    
                    <div class="visualization-area">
                        <div class="chart-container" id="tutorial-content">
                            <h3>Select a Tutorial</h3>
                            <div class="educational-tip">
                                <strong>Recommended Learning Path:</strong>
                                <ol style="margin: 10px 0; padding-left: 20px; line-height: 1.8;">
                                    <li>Start with PBPK Basics to understand drug pharmacokinetics</li>
                                    <li>Move to Clinical Trial Designs to learn about dose finding</li>
                                    <li>Explore Molecular Simulations for drug-target interactions</li>
                                    <li>Learn how to document and share your findings</li>
                                    <li>Complete the integrated case study</li>
                                </ol>
                            </div>
                            
                            <div class="info-box" style="margin-top: 20px;">
                                <h4>Quick Reference Formulas</h4>
                                <div style="font-family: monospace; margin: 10px 0;">
                                    <p><strong>Clearance:</strong> CL = Dose / AUC</p>
                                    <p><strong>Half-life:</strong> t½ = 0.693 × Vd / CL</p>
                                    <p><strong>Loading Dose:</strong> LD = Vd × Css</p>
                                    <p><strong>Maintenance Dose:</strong> MD = CL × Css × τ</p>
                                    <p><strong>Bioavailability:</strong> F = AUC(oral) / AUC(iv)</p>
                                </div>
                            </div>
                            
                            <div class="disclaimer-banner" style="margin-top: 20px;">
                                <h4>Remember</h4>
                                <p>
                                    All simulations provide theoretical estimates. Always validate computational 
                                    predictions with appropriate experimental methods before making research or 
                                    clinical decisions.
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <div class="footer-content">
            <div class="footer-attribution">
                <strong>PharmaSim Pro</strong><br>
                Created by <strong>David Ferguson, BS, MS, Pharm.D. Candidate</strong><br>
                Powered by <strong>Anthropic Claude AI</strong><br>
                Version 1.0.0 | January 2025
            </div>
            <div class="footer-links">
                <a href="https://github.com/pharmasim-pro" target="_blank">GitHub Repository</a>
                <a href="#" onclick="showAbout()">About</a>
                <a href="#" onclick="showDisclaimer()">Full Disclaimer</a>
                <a href="#" onclick="showCitation()">How to Cite</a>
                <a href="mailto:contact@pharmasim.pro">Contact</a>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let charts = {};
        let simulations = {};
        let currentModule = 'pbpk';
        let animationFrames = {};
        let capturedData = {};
        let rdkit;
        let viewer;
        
        // Initialize RDKit
        window.initRDKitModule().then(function(RDKit) {
            rdkit = RDKit;
            console.log("RDKit version: " + rdkit.version());
        }).catch(() => {
            console.error("Failed to load RDKit module.");
        });

        // Initialize all charts
        function initializeCharts() {
            const chartOptions = {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: { color: '#333' }
                    }
                },
                scales: {
                    x: {
                        grid: { color: 'rgba(0,0,0,0.05)' },
                        ticks: { color: '#666' }
                    },
                    y: {
                        grid: { color: 'rgba(0,0,0,0.05)' },
                        ticks: { color: '#666' }
                    }
                }
            };
            
            // PBPK Charts
            const pkCtx = document.getElementById('pkChart');
            if (pkCtx) {
                charts.pk = new Chart(pkCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Plasma Concentration',
                            data: [],
                            borderColor: '#2a5298',
                            backgroundColor: 'rgba(42,82,152,0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        ...chartOptions,
                        scales: {
                            ...chartOptions.scales,
                            y: {
                                ...chartOptions.scales.y,
                                title: { display: true, text: 'Concentration (ng/mL)' }
                            },
                            x: {
                                ...chartOptions.scales.x,
                                title: { display: true, text: 'Time (hours)' }
                            }
                        }
                    }
                });
            }
            
            const qspCtx = document.getElementById('qspChart');
            if (qspCtx) {
                charts.qsp = new Chart(qspCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'Target Occupancy',
                            data: [],
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102,126,234,0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        ...chartOptions,
                        scales: {
                            ...chartOptions.scales,
                            y: {
                                ...chartOptions.scales.y,
                                title: { display: true, text: 'Occupancy (%)' },
                                min: 0,
                                max: 100
                            },
                            x: {
                                ...chartOptions.scales.x,
                                title: { display: true, text: 'Time (hours)' }
                            }
                        }
                    }
                });
            }
            
            // Tissue Distribution Chart
            const tissueCtx = document.getElementById('tissueChart');
            if (tissueCtx) {
                charts.tissue = new Chart(tissueCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Plasma', 'Liver', 'Kidney', 'Brain', 'Muscle'],
                        datasets: [{
                            label: 'Tissue Concentration',
                            data: [100, 85, 120, 15, 45],
                            backgroundColor: ['#2a5298', '#667eea', '#4facfe', '#00f2fe', '#764ba2'],
                            borderColor: '#1e3c72',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        ...chartOptions,
                        scales: {
                            ...chartOptions.scales,
                            y: {
                                ...chartOptions.scales.y,
                                title: { display: true, text: 'Relative Concentration (%)' }
                            }
                        }
                    }
                });
            }
            
            // DDI Chart
            const ddiCtx = document.getElementById('ddiChart');
            if (ddiCtx) {
                charts.ddi = new Chart(ddiCtx, {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 49}, (_, i) => i * 0.5),
                        datasets: [{
                            label: 'Without Inhibitor',
                            data: [],
                            borderColor: '#2a5298',
                            backgroundColor: 'rgba(42,82,152,0.1)',
                            tension: 0.4
                        }, {
                            label: 'With CYP3A4 Inhibitor',
                            data: [],
                            borderColor: '#f5576c',
                            backgroundColor: 'rgba(245,87,108,0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        ...chartOptions,
                        scales: {
                            ...chartOptions.scales,
                            y: {
                                ...chartOptions.scales.y,
                                title: { display: true, text: 'Concentration (ng/mL)' }
                            },
                            x: {
                                ...chartOptions.scales.x,
                                title: { display: true, text: 'Time (hours)' }
                            }
                        }
                    }
                });
            }
            
            // Clinical Trial Charts
            const trialCtx = document.getElementById('trialChart');
            if (trialCtx) {
                charts.trial = new Chart(trialCtx, {
                    type: 'scatter',
                    data: {
                        datasets: [{
                            label: 'No DLT',
                            data: [],
                            backgroundColor: '#4facfe',
                            pointRadius: 8
                        }, {
                            label: 'DLT',
                            data: [],
                            backgroundColor: '#f5576c',
                            pointRadius: 8
                        }]
                    },
                    options: {
                        ...chartOptions,
                        scales: {
                            ...chartOptions.scales,
                            y: {
                                ...chartOptions.scales.y,
                                title: { display: true, text: 'Dose Level (mg)' }
                            },
                            x: {
                                ...chartOptions.scales.x,
                                title: { display: true, text: 'Patient Number' }
                            }
                        }
                    }
                });
            }
            
            const toxicityCtx = document.getElementById('toxicityChart');
            if (toxicityCtx) {
                charts.toxicity = new Chart(toxicityCtx, {
                    type: 'line',
                    data: {
                        labels: [],
                        datasets: [{
                            label: 'True Toxicity',
                            data: [],
                            borderColor: '#f5576c',
                            backgroundColor: 'rgba(245,87,108,0.1)',
                            tension: 0.4
                        }, {
                            label: 'Estimated Toxicity',
                            data: [],
                            borderColor: '#2a5298',
                            backgroundColor: 'rgba(42,82,152,0.1)',
                            tension: 0.4,
                            borderDash: [5, 5]
                        }]
                    },
                    options: {
                        ...chartOptions,
                        scales: {
                            ...chartOptions.scales,
                            y: {
                                ...chartOptions.scales.y,
                                title: { display: true, text: 'Toxicity Probability' },
                                min: 0,
                                max: 1
                            },
                            x: {
                                ...chartOptions.scales.x,
                                title: { display: true, text: 'Dose (mg)' }
                            }
                        }
                    }
                });
            }
            
            const comparisonCtx = document.getElementById('comparisonChart');
            if (comparisonCtx) {
                charts.comparison = new Chart(comparisonCtx, {
                    type: 'bar',
                    data: {
                        labels: ['3+3', 'CRM', 'BOIN', 'EWOC', 'BLRM', 'mTPI'],
                        datasets: [{
                            label: 'Success Rate (%)',
                            data: [45, 78, 72, 68, 75, 70],
                            backgroundColor: '#2a5298'
                        }, {
                            label: 'Avg Patients',
                            data: [18, 24, 21, 27, 24, 22],
                            backgroundColor: '#667eea'
                        }]
                    },
                    options: {
                        ...chartOptions,
                        scales: {
                            ...chartOptions.scales,
                            y: {
                                ...chartOptions.scales.y,
                                title: { display: true, text: 'Value' }
                            }
                        }
                    }
                });
            }
            
            const ocCtx = document.getElementById('ocChart');
            if (ocCtx) {
                charts.oc = new Chart(ocCtx, {
                    type: 'radar',
                    data: {
                        labels: ['Efficiency', 'Safety', 'Accuracy', 'Simplicity', 'Robustness'],
                        datasets: [{
                            label: '3+3',
                            data: [3, 7, 4, 9, 6],
                            borderColor: '#f5576c',
                            backgroundColor: 'rgba(245,87,108,0.2)'
                        }, {
                            label: 'CRM',
                            data: [9, 6, 8, 4, 7],
                            borderColor: '#2a5298',
                            backgroundColor: 'rgba(42,82,152,0.2)'
                        }, {
                            label: 'BOIN',
                            data: [8, 7, 7, 7, 8],
                            borderColor: '#4facfe',
                            backgroundColor: 'rgba(79,172,254,0.2)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                labels: { color: '#333' }
                            }
                        },
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 10,
                                ticks: { color: '#666' },
                                grid: { color: 'rgba(0,0,0,0.1)' }
                            }
                        }
                    }
                });
            }
            
            // Molecular Dynamics Charts
            const energyCtx = document.getElementById('energyChart');
            if (energyCtx) {
                charts.energy = new Chart(energyCtx, {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 101}, (_, i) => i),
                        datasets: [{
                            label: 'Total Energy',
                            data: Array.from({length: 101}, () => -1200 + Math.random() * 100),
                            borderColor: '#2a5298',
                            backgroundColor: 'rgba(42,82,152,0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        ...chartOptions,
                        scales: {
                            ...chartOptions.scales,
                            y: {
                                ...chartOptions.scales.y,
                                title: { display: true, text: 'Energy (kJ/mol)' }
                            },
                            x: {
                                ...chartOptions.scales.x,
                                title: { display: true, text: 'Time (ps)' }
                            }
                        }
                    }
                });
            }
            
            const rmsdCtx = document.getElementById('rmsdChart');
            if (rmsdCtx) {
                charts.rmsd = new Chart(rmsdCtx, {
                    type: 'line',
                    data: {
                        labels: Array.from({length: 101}, (_, i) => i),
                        datasets: [{
                            label: 'RMSD',
                            data: Array.from({length: 101}, (_, i) => Math.sin(i/10) + 2 + Math.random() * 0.5),
                            borderColor: '#667eea',
                            backgroundColor: 'rgba(102,126,234,0.1)',
                            tension: 0.4
                        }]
                    },
                    options: {
                        ...chartOptions,
                        scales: {
                            ...chartOptions.scales,
                            y: {
                                ...chartOptions.scales.y,
                                title: { display: true, text: 'RMSD (Å)' }
                            },
                            x: {
                                ...chartOptions.scales.x,
                                title: { display: true, text: 'Time (ps)' }
                            }
                        }
                    }
                });
            }
            
            const interactionCtx = document.getElementById('interactionChart');
            if (interactionCtx) {
                charts.interaction = new Chart(interactionCtx, {
                    type: 'bar',
                    data: {
                        labels: ['H-Bonds', 'Hydrophobic', 'Electrostatic', 'Van der Waals'],
                        datasets: [{
                            label: 'Interaction Count',
                            data: [4, 12, 2, 18],
                            backgroundColor: ['#2a5298', '#667eea', '#4facfe', '#00f2fe']
                        }]
                    },
                    options: {
                        ...chartOptions,
                        scales: {
                            ...chartOptions.scales,
                            y: {
                                ...chartOptions.scales.y,
                                title: { display: true, text: 'Number of Interactions' }
                            }
                        }
                    }
                });
            }
        }
        
        // Module switching
        function switchModule(module) {
            document.querySelectorAll('.module-section').forEach(section => {
                section.classList.remove('active');
            });
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(module + '-module').classList.add('active');
            document.querySelector(`.nav-tab[onclick="switchModule('${module}')"]`).classList.add('active');
            currentModule = module;
        }
        
        // Tab switching within modules
        function switchTab(tabName, module) {
            const modulePrefix = module + '-';
            document.querySelectorAll(`#${module}-module .tab-content`).forEach(content => {
                content.classList.remove('active');
            });
            document.querySelectorAll(`#${module}-module .tab-button`).forEach(button => {
                button.classList.remove('active');
            });
            
            document.getElementById(tabName + '-tab').classList.add('active');
            event.target.classList.add('active');
        }
        
        // Capture results for publication
        function captureResults(module) {
            const timestamp = new Date().toISOString();
            
            if (module === 'pbpk') {
                capturedData.pbpk = {
                    drugName: document.getElementById('drug-name').value || 'Unknown Drug',
                    targetProtein: document.getElementById('target-protein').value || 'Unknown Target',
                    parameters: {
                        bioavailability: document.getElementById('bioavailability').value,
                        clearance: document.getElementById('clearance').value,
                        vd: document.getElementById('vd').value,
                        ka: document.getElementById('ka').value,
                        ec50: document.getElementById('ec50').value
                    },
                    results: {
                        cmax: document.getElementById('cmax').textContent,
                        tmax: document.getElementById('tmax').textContent,
                        auc: document.getElementById('auc').textContent,
                        halfLife: document.getElementById('halflife').textContent
                    },
                    timestamp: timestamp
                };
                alert('PBPK results captured! Navigate to Research Publications to create your publication.');
            } else if (module === 'clinical') {
                capturedData.clinical = {
                    drugName: document.getElementById('study-drug-name').value || 'Unknown Drug',
                    designType: document.getElementById('design-type').value,
                    results: {
                        mtd: document.getElementById('mtd').textContent,
                        rp2d: document.getElementById('rp2d').textContent,
                        dltRate: document.getElementById('dlt-rate').textContent,
                        totalPatients: document.getElementById('total-patients').textContent
                    },
                    timestamp: timestamp
                };
                alert('Clinical trial results captured! Navigate to Research Publications to create your publication.');
            } else if (module === 'molecular') {
                capturedData.molecular = {
                    structure: document.getElementById('smilesInput').value || 'Unknown Structure',
                    results: {
                        energy: document.getElementById('total-energy').textContent,
                        bindingAffinity: document.getElementById('binding-affinity').textContent,
                        rmsd: document.getElementById('rmsd').textContent,
                        hbonds: document.getElementById('hbonds').textContent
                    },
                    timestamp: timestamp
                };
                alert('Molecular simulation results captured! Navigate to Research Publications to create your publication.');
            }
            
            // Auto-populate publication form if on publications page
            if (currentModule === 'publications') {
                populatePublicationForm();
            }
        }
        
        // Populate publication form with captured data
        function populatePublicationForm() {
            if (capturedData.pbpk) {
                const drugEl = document.getElementById('pub-drug');
                const proteinEl = document.getElementById('pub-protein');
                const dataEl = document.getElementById('pub-data');
                
                if (drugEl) drugEl.value = capturedData.pbpk.drugName;
                if (proteinEl) proteinEl.value = capturedData.pbpk.targetProtein;
                
                if (dataEl) {
                    const dataText = `
Pharmacokinetic Parameters:
- Bioavailability: ${capturedData.pbpk.parameters.bioavailability}%
- Clearance: ${capturedData.pbpk.parameters.clearance} L/h
- Volume of Distribution: ${capturedData.pbpk.parameters.vd} L
- Absorption Rate: ${capturedData.pbpk.parameters.ka} h⁻¹
- EC50: ${capturedData.pbpk.parameters.ec50} nM

Results:
- Cmax: ${capturedData.pbpk.results.cmax}
- Tmax: ${capturedData.pbpk.results.tmax}
- AUC: ${capturedData.pbpk.results.auc}
- Half-life: ${capturedData.pbpk.results.halfLife}
                    `.trim();
                    
                    dataEl.value = dataText;
                }
            }
            
            if (capturedData.clinical) {
                const dataEl = document.getElementById('pub-data');
                const clinicalText = `
Clinical Trial Design: ${capturedData.clinical.designType}
- MTD: ${capturedData.clinical.results.mtd}
- RP2D: ${capturedData.clinical.results.rp2d}
- DLT Rate: ${capturedData.clinical.results.dltRate}
- Total Patients: ${capturedData.clinical.results.totalPatients}
                `.trim();
                
                if (dataEl) {
                    const currentData = dataEl.value;
                    dataEl.value = currentData ? 
                        currentData + '\n\n' + clinicalText : clinicalText;
                }
            }
        }
        
        // Publish findings with proper validation
        function publishFindings() {
            const titleEl = document.getElementById('pub-title');
            const authorsEl = document.getElementById('pub-authors');
            const drugEl = document.getElementById('pub-drug');
            const proteinEl = document.getElementById('pub-protein');
            const findingsEl = document.getElementById('pub-findings');
            const dataEl = document.getElementById('pub-data');
            const implicationsEl = document.getElementById('pub-implications');
            
            if (!titleEl || !authorsEl || !drugEl || !proteinEl || !findingsEl) {
                alert('Publication form elements not found. Please refresh the page.');
                return;
            }
            
            const title = titleEl.value.trim();
            const authors = authorsEl.value.trim();
            const drug = drugEl.value.trim();
            const protein = proteinEl.value.trim();
            const findings = findingsEl.value.trim();
            const data = dataEl ? dataEl.value.trim() : '';
            const implications = implicationsEl ? implicationsEl.value.trim() : '';
            
            if (!title || !authors || !drug || !protein || !findings) {
                alert('Please fill in all required fields (Title, Authors, Drug, Protein, and Key Findings) before publishing.');
                return;
            }
            
            const publication = {
                title: title,
                authors: authors,
                date: new Date().toLocaleDateString('en-US', { 
                    year: 'numeric', 
                    month: 'long', 
                    day: 'numeric' 
                }),
                drug: drug,
                protein: protein,
                findings: findings,
                data: data,
                implications: implications
            };
            
            // Create new publication card HTML
            const publicationHTML = `
                <div class="blog-post-card">
                    <h4 class="blog-post-title">${publication.title}</h4>
                    <div class="blog-post-meta">By ${publication.authors} • ${publication.date}</div>
                    <div class="blog-post-content">
                        <strong>Abstract:</strong><br>
                        We performed computational modeling of ${publication.drug} interaction with ${publication.protein} 
                        using PharmaSim Pro (Ferguson, D.; Anthropic Claude AI).<br><br>
                        
                        <strong>Major Findings:</strong><br>
                        ${publication.findings}<br><br>
                        
                        ${publication.data ? `<strong>Key Data:</strong><br>
                        <pre style="background: #f5f5f5; padding: 10px; border-radius: 5px; font-size: 12px; white-space: pre-wrap; overflow-x: auto;">${publication.data}</pre><br>` : ''}
                        
                        ${publication.implications ? `<strong>Implications for Early-Stage Scientists:</strong><br>
                        ${publication.implications}<br><br>` : ''}
                        
                        <strong>Disclaimer:</strong><br>
                        <em>These computational predictions require validation through experimental studies. 
                        Values represent theoretical estimates from simplified models.</em><br><br>
                        
                        <strong>Citation:</strong><br>
                        <em>Created using PharmaSim Pro by David Ferguson, BS, MS, Pharm.D. Candidate, 
                        powered by Anthropic Claude AI. Source code available on GitHub for transparency.</em>
                    </div>
                </div>
            `;
            
            // Add to publications list
            const publicationsList = document.getElementById('publications-list');
            if (publicationsList) {
                publicationsList.insertAdjacentHTML('afterbegin', publicationHTML);
                
                // Animate the new publication
                const newCard = publicationsList.firstElementChild;
                if (newCard) {
                    newCard.style.opacity = '0';
                    newCard.style.transform = 'translateY(20px)';
                    setTimeout(() => {
                        newCard.style.transition = 'all 0.5s ease';
                        newCard.style.opacity = '1';
                        newCard.style.transform = 'translateY(0)';
                    }, 100);
                }
                
                alert('🎉 Publication successfully created and added to the Recent Publications section!');
                clearPublication();
                
                // Scroll to show the new publication
                setTimeout(() => {
                    publicationsList.scrollIntoView({ behavior: 'smooth', block: 'start' });
                }, 600);
            } else {
                alert('Error: Publications list not found. Please refresh the page and try again.');
            }
        }
        
        // Enhanced export molecular data function
        function exportMolecularData() {
            const data = {
                timestamp: new Date().toISOString(),
                structure: document.getElementById('smilesInput')?.value || 'Unknown',
                simulationType: document.getElementById('sim-type')?.value || 'md',
                temperature: document.getElementById('mdTemp')?.value || '300',
                forceField: document.getElementById('forceField')?.value || 'amber',
                results: {
                    totalEnergy: document.getElementById('total-energy')?.textContent || '--',
                    bindingAffinity: document.getElementById('binding-affinity')?.textContent || '--',
                    rmsd: document.getElementById('rmsd')?.textContent || '--',
                    hbonds: document.getElementById('hbonds')?.textContent || '--',
                    rg: document.getElementById('rg')?.textContent || '--',
                    sasa: document.getElementById('sasa')?.textContent || '--'
                },
                disclaimer: 'Data generated by PharmaSim Pro (Ferguson, D.; Anthropic Claude AI). Computational estimates require experimental validation.',
                citation: 'Ferguson, D. (2025). PharmaSim Pro. Powered by Anthropic Claude AI.'
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `molecular_dynamics_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            alert('Molecular dynamics data exported successfully!');
        }
        
        // Preview publication
        function previewPublication() {
            const title = document.getElementById('pub-title').value || '[Title]';
            const authors = document.getElementById('pub-authors').value || '[Authors]';
            const drug = document.getElementById('pub-drug').value || '[Drug Name]';
            const protein = document.getElementById('pub-protein').value || '[Protein Name]';
            const findings = document.getElementById('pub-findings').value || '[Key Findings]';
            const data = document.getElementById('pub-data').value || '[Data Values]';
            const implications = document.getElementById('pub-implications').value || '[Implications]';
            
            const previewHTML = `
                <h3>Publication Preview</h3>
                <div class="blog-post-card">
                    <h4 class="blog-post-title">${title}</h4>
                    <div class="blog-post-meta">By ${authors} • ${new Date().toLocaleDateString()}</div>
                    <div class="blog-post-content">
                        <strong>Abstract:</strong><br>
                        We performed computational modeling of ${drug} interaction with ${protein} 
                        using PharmaSim Pro (Ferguson, D.; Anthropic Claude AI).<br><br>
                        
                        <strong>Major Findings:</strong><br>
                        ${findings}<br><br>
                        
                        <strong>Key Parameters:</strong><br>
                        <pre style="background: #f5f5f5; padding: 10px; border-radius: 5px;">${data}</pre>
                        <br>
                        
                        <strong>Implications for Early-Stage Scientists:</strong><br>
                        ${implications}<br><br>
                        
                        <strong>Disclaimer:</strong><br>
                        <em>These computational predictions require validation through experimental studies. 
                        Values represent theoretical estimates from simplified models.</em><br><br>
                        
                        <strong>Citation:</strong><br>
                        Created using PharmaSim Pro by David Ferguson (Pharm.D. Candidate) 
                        powered by Anthropic Claude AI. Code available on GitHub.
                    </div>
                </div>
            `;
            
            const previewDiv = document.getElementById('publication-preview');
            previewDiv.innerHTML = previewHTML;
            previewDiv.style.display = 'block';
            previewDiv.scrollIntoView({ behavior: 'smooth' });
        }
        
        // Clear publication form
        function clearPublication() {
            document.getElementById('pub-title').value = '';
            document.getElementById('pub-authors').value = '';
            document.getElementById('pub-drug').value = '';
            document.getElementById('pub-protein').value = '';
            document.getElementById('pub-findings').value = '';
            document.getElementById('pub-data').value = '';
            document.getElementById('pub-implications').value = '';
            document.getElementById('publication-preview').style.display = 'none';
        }
        
        // Completely rewritten PBPK Model with parameter-dependent outputs
        class PBPKModel {
            constructor(params) {
                // Store all parameters
                this.dose = parseFloat(params.dose) || 100;
                this.bioavailability = parseFloat(params.bioavailability) || 80;
                this.ka = parseFloat(params.ka) || 1.5;
                this.clearance = parseFloat(params.clearance) || 1.2;
                this.vd = parseFloat(params.vd) || 70;
                this.proteinBinding = parseFloat(params.proteinBinding) || 90;
                this.logp = parseFloat(params.logp) || 2.5;
                this.mw = parseFloat(params.mw) || 350;
                this.formulation = params.formulation || 'immediate';
                this.enzyme = params.enzyme || 'cyp3a4';
                this.renalFunction = params.renalFunction || 'normal';
                
                // Calculate derived parameters
                this.f = this.bioavailability / 100;
                this.fu = (100 - this.proteinBinding) / 100; // Free fraction
                this.ke = this.clearance / this.vd; // Elimination rate constant
                
                console.log('PBPK Model Parameters:', {
                    dose: this.dose,
                    bioavailability: this.bioavailability,
                    ka: this.ka,
                    clearance: this.clearance,
                    vd: this.vd,
                    logp: this.logp,
                    mw: this.mw
                });
            }
            
            simulate(timePoints) {
                const concentrations = [];
                
                // Adjust absorption based on formulation
                let adjustedKa = this.ka;
                let lagTime = 0;
                let bioMod = 1.0;
                
                switch(this.formulation) {
                    case 'extended':
                        adjustedKa = this.ka * 0.2; // Much slower release
                        break;
                    case 'enteric':
                        lagTime = 1.5; // Delay for gastric emptying
                        adjustedKa = this.ka * 0.8;
                        break;
                    case 'sublingual':
                        adjustedKa = this.ka * 4; // Rapid absorption
                        bioMod = 1.3; // Bypass first-pass
                        break;
                }
                
                const effectiveBio = Math.min(this.f * bioMod, 1.0);
                const adjustedDose = this.dose * effectiveBio;
                
                for (let t of timePoints) {
                    let concentration = 0;
                    const effectiveTime = Math.max(0, t - lagTime);
                    
                    if (effectiveTime > 0) {
                        // One-compartment model with first-order absorption
                        if (Math.abs(adjustedKa - this.ke) < 1e-6) {
                            // Special case when ka ≈ ke
                            concentration = (adjustedDose / this.vd) * adjustedKa * effectiveTime * Math.exp(-this.ke * effectiveTime);
                        } else {
                            // General case
                            const A = adjustedDose * adjustedKa / (this.vd * (adjustedKa - this.ke));
                            concentration = A * (Math.exp(-this.ke * effectiveTime) - Math.exp(-adjustedKa * effectiveTime));
                        }
                    }
                    
                    // Convert to ng/mL and ensure non-negative
                    concentrations.push(Math.max(0, concentration * 1000));
                }
                
                return concentrations;
            }
            
            calculateTissueDistribution(plasmaConc) {
                // Tissue:plasma ratios based on physicochemical properties
                const ratios = {};
                
                // Brain: heavily dependent on LogP, MW, and protein binding
                if (this.mw > 1000) {
                    ratios.brain = 0.01; // Large molecules don't cross BBB
                } else if (this.logp < 0) {
                    ratios.brain = 0.05 + (this.logp * 0.01); // Hydrophilic
                } else {
                    ratios.brain = 0.1 + (this.logp * 0.2) * this.fu; // Free drug crosses BBB
                }
                ratios.brain = Math.max(0.01, Math.min(ratios.brain, 2.0));
                
                // Liver: depends on clearance (metabolism) and lipophilicity
                ratios.liver = 1.0 + (this.clearance * 0.5) + (this.logp * 0.3);
                if (this.enzyme === 'cyp3a4') ratios.liver *= 1.2; // High hepatic metabolism
                
                // Kidney: affected by protein binding (filtration) and MW
                ratios.kidney = 1.5 * this.fu + 0.3; // Free drug filtered
                if (this.mw > 500) ratios.kidney *= 0.7; // Large molecules filtered less
                
                // Muscle: moderate distribution, affected by lipophilicity
                ratios.muscle = 0.4 + (this.logp * 0.15) + (this.vd / 500);
                
                // Fat: highly dependent on lipophilicity
                ratios.fat = 0.1 + Math.max(0, this.logp) * 1.2;
                if (this.logp > 3) ratios.fat += 2.0; // Very lipophilic drugs
                
                // Heart: moderate, similar to muscle but higher perfusion
                ratios.heart = 0.6 + (this.logp * 0.2) + (this.clearance * 0.1);
                
                // Bone: low for most drugs unless specific affinity
                ratios.bone = 0.1 + (this.mw < 200 ? 0.2 : 0);
                
                // Calculate absolute concentrations
                const tissueConcs = {};
                Object.keys(ratios).forEach(tissue => {
                    tissueConcs[tissue] = plasmaConc * ratios[tissue];
                });
                
                return tissueConcs;
            }
            
            calculateTargetOccupancy(concentrations, ec50, hill) {
                return concentrations.map(totalConc => {
                    // Only free drug binds to target
                    const freeConc = totalConc * this.fu;
                    // Hill equation for target occupancy
                    const occupancy = (Math.pow(freeConc, hill) / (Math.pow(ec50, hill) + Math.pow(freeConc, hill))) * 100;
                    return Math.min(100, Math.max(0, occupancy));
                });
            }
            
            simulateWithInhibitor() {
                // Different enzymes have different inhibition potential
                const inhibitionFactors = {
                    'cyp3a4': 0.15,  // 85% inhibition
                    'cyp2d6': 0.30,  // 70% inhibition  
                    'cyp2c9': 0.25,  // 75% inhibition
                    'cyp1a2': 0.45,  // 55% inhibition
                    'cyp2c19': 0.35, // 65% inhibition
                    'ugt': 0.60      // 40% inhibition
                };
                
                const inhibitedClearance = this.clearance * (inhibitionFactors[this.enzyme] || 0.5);
                
                // Create new model with reduced clearance
                const inhibitedModel = new PBPKModel({
                    ...this.getAllParams(),
                    clearance: inhibitedClearance
                });
                
                return inhibitedModel;
            }
            
            getAllParams() {
                return {
                    dose: this.dose,
                    bioavailability: this.bioavailability,
                    ka: this.ka,
                    clearance: this.clearance,
                    vd: this.vd,
                    proteinBinding: this.proteinBinding,
                    logp: this.logp,
                    mw: this.mw,
                    formulation: this.formulation,
                    enzyme: this.enzyme,
                    renalFunction: this.renalFunction
                };
            }
            
            calculateMetrics(concentrations, timePoints) {
                const cmax = Math.max(...concentrations);
                const cmaxIndex = concentrations.indexOf(cmax);
                const tmax = timePoints[cmaxIndex];
                
                // AUC calculation using trapezoidal rule
                let auc = 0;
                for (let i = 1; i < concentrations.length; i++) {
                    const dt = timePoints[i] - timePoints[i-1];
                    const avgConc = (concentrations[i] + concentrations[i-1]) / 2;
                    auc += avgConc * dt;
                }
                
                // Half-life calculation (accounting for renal function)
                let halfLife = 0.693 / this.ke;
                const renalMultipliers = {
                    'normal': 1.0,
                    'mild': 1.3,
                    'moderate': 2.0,
                    'severe': 4.0
                };
                halfLife *= renalMultipliers[this.renalFunction];
                
                // Steady-state volume
                const vss = this.vd * (1 + Math.max(0, this.logp) * 0.3);
                
                return {
                    cmax: cmax.toFixed(1),
                    tmax: tmax.toFixed(1), 
                    auc: auc.toFixed(0),
                    halfLife: halfLife.toFixed(1),
                    clearance: this.clearance.toFixed(2),
                    vss: vss.toFixed(1),
                    freeConc: (cmax * this.fu).toFixed(1)
                };
            }
        }
        
        // Clinical Trial Simulations
        class BayesianTrial {
            constructor(params) {
                this.designType = params.designType;
                this.targetToxicity = params.targetToxicity;
                this.cohorts = params.cohorts;
                this.cohortSize = params.cohortSize;
                this.startDose = params.startDose;
                this.maxDose = params.maxDose;
                this.escalationScheme = params.escalationScheme;
                this.doseLevels = this.generateDoseLevels();
            }
            
            generateDoseLevels() {
                const levels = [];
                let currentDose = this.startDose;
                levels.push(currentDose);
                
                if (this.escalationScheme === 'fibonacci') {
                    const increments = [1.67, 1.5, 1.4, 1.33, 1.33, 1.33];
                    for (let i = 0; i < this.cohorts - 1 && currentDose < this.maxDose; i++) {
                        currentDose *= increments[Math.min(i, increments.length - 1)];
                        levels.push(Math.min(currentDose, this.maxDose));
                    }
                } else if (this.escalationScheme === 'doubling') {
                    while (levels.length < this.cohorts && currentDose < this.maxDose) {
                        currentDose *= 2;
                        levels.push(Math.min(currentDose, this.maxDose));
                    }
                } else {
                    const ratio = Math.pow(this.maxDose / this.startDose, 1 / (this.cohorts - 1));
                    for (let i = 1; i < this.cohorts; i++) {
                        levels.push(this.startDose * Math.pow(ratio, i));
                    }
                }
                
                return levels;
            }
            
            getToxicityProbability(dose) {
                const steepness = 0.02;
                const midpoint = this.maxDose * 0.6;
                return 1 / (1 + Math.exp(-steepness * (dose - midpoint)));
            }
            
            runTrial() {
                // Simplified trial simulation
                let currentDoseIndex = 0;
                const results = { 
                    patients: [], 
                    mtd: null,
                    totalPatients: 0,
                    patientsWithDLT: 0
                };
                
                const totalPatients = this.cohorts * this.cohortSize;
                
                for (let p = 0; p < totalPatients; p++) {
                    results.totalPatients++;
                    const hasDLT = Math.random() < this.getToxicityProbability(this.doseLevels[currentDoseIndex]);
                    if (hasDLT) results.patientsWithDLT++;
                    
                    results.patients.push({
                        x: p + 1,
                        y: this.doseLevels[currentDoseIndex],
                        dlt: hasDLT
                    });
                    
                    // Simple escalation logic
                    if ((p + 1) % this.cohortSize === 0) {
                        const cohortDLTs = results.patients.slice(-this.cohortSize).filter(p => p.dlt).length;
                        const dltRate = cohortDLTs / this.cohortSize;
                        
                        if (dltRate < this.targetToxicity - 0.1 && currentDoseIndex < this.doseLevels.length - 1) {
                            currentDoseIndex++;
                        } else if (dltRate > this.targetToxicity + 0.1 && currentDoseIndex > 0) {
                            currentDoseIndex--;
                        }
                    }
                }
                
                results.mtd = this.doseLevels[currentDoseIndex];
                return results;
            }
        }
        
        // Run PBPK Simulation
        function runPBPKSimulation() {
            showLoading();
            
            setTimeout(() => {
                const params = {
                    clearance: parseFloat(document.getElementById('clearance').value),
                    vd: parseFloat(document.getElementById('vd').value),
                    ka: parseFloat(document.getElementById('ka').value),
                    bioavailability: parseFloat(document.getElementById('bioavailability').value),
                    proteinBinding: parseFloat(document.getElementById('protein-binding').value)
                };
                
                const timePoints = [];
                for (let t = 0; t <= 48; t += 0.5) {
                    timePoints.push(t);
                }
                
                const model = new PBPKModel(params);
                const concentrations = model.simulate(timePoints);
                const metrics = model.calculateMetrics(concentrations, timePoints);
                
                // Update charts
                charts.pk.data.labels = timePoints;
                charts.pk.data.datasets[0].data = concentrations;
                charts.pk.update();
                
                // Update QSP chart
                const occupancy = concentrations.map(c => {
                    const ec50 = parseFloat(document.getElementById('ec50').value);
                    const hill = parseFloat(document.getElementById('hill').value);
                    return (Math.pow(c, hill) / (Math.pow(ec50, hill) + Math.pow(c, hill))) * 100;
                });
                
                charts.qsp.data.labels = timePoints;
                charts.qsp.data.datasets[0].data = occupancy;
                charts.qsp.update();
                
                // Update metrics
                document.getElementById('cmax').textContent = metrics.cmax;
                document.getElementById('tmax').textContent = metrics.tmax + ' h';
                document.getElementById('auc').textContent = metrics.auc;
                document.getElementById('halflife').textContent = metrics.halfLife + ' h';
                document.getElementById('cl-calc').textContent = metrics.clearance + ' L/h';
                document.getElementById('vss').textContent = metrics.vss + ' L';
                
                hideLoading();
            }, 500);
        }
        
        // Run Clinical Trial Simulation
        function runTrialSimulation() {
            showLoading();
            
            setTimeout(() => {
                const params = {
                    designType: document.getElementById('design-type').value,
                    targetToxicity: parseFloat(document.getElementById('target-tox').value),
                    cohorts: parseInt(document.getElementById('cohorts').value),
                    cohortSize: parseInt(document.getElementById('cohort-size').value),
                    startDose: parseFloat(document.getElementById('start-dose').value),
                    maxDose: parseFloat(document.getElementById('max-dose').value),
                    escalationScheme: document.getElementById('escalation-scheme').value
                };
                
                const trial = new BayesianTrial(params);
                const results = trial.runTrial();
                
                // Update chart
                const noDLT = results.patients.filter(p => !p.dlt);
                const withDLT = results.patients.filter(p => p.dlt);
                
                charts.trial.data.datasets[0].data = noDLT;
                charts.trial.data.datasets[1].data = withDLT;
                charts.trial.update();
                
                // Update metrics
                document.getElementById('mtd').textContent = results.mtd ? results.mtd.toFixed(0) + ' mg' : 'Not Found';
                document.getElementById('rp2d').textContent = results.mtd ? (results.mtd * 0.8).toFixed(0) + ' mg' : 'N/A';
                document.getElementById('dlt-rate').textContent = results.mtd ? 
                    (trial.getToxicityProbability(results.mtd) * 100).toFixed(1) + '%' : 'N/A';
                document.getElementById('total-patients').textContent = results.totalPatients;
                document.getElementById('patients-dlt').textContent = results.patientsWithDLT;
                document.getElementById('trial-duration').textContent = 
                    Math.ceil(results.totalPatients / 3 * 4) + ' weeks';
                
                hideLoading();
            }, 500);
        }
        
        // Other simulation functions
        function runMonteCarloTrials() {
            alert('Running 1000 Monte Carlo simulations... This feature demonstrates multiple trial runs.');
        }
        
        function compareDesigns() {
            alert('Comparing all 6 Bayesian trial designs... Results will show efficiency metrics.');
        }
        
        function updateDesignInfo() {
            const designType = document.getElementById('design-type').value;
            const infoBox = document.getElementById('design-info');
            
            const designDescriptions = {
                '3plus3': {
                    title: '3+3 Design',
                    description: 'Traditional rule-based design. Simple but inefficient.'
                },
                'crm': {
                    title: 'CRM - Continual Reassessment Method',
                    description: 'Model-based design using Bayesian inference. More efficient than 3+3.'
                },
                'boin': {
                    title: 'BOIN - Bayesian Optimal Interval',
                    description: 'Interval-based design that\'s simpler than CRM but efficient.'
                },
                'ewoc': {
                    title: 'EWOC - Escalation with Overdose Control',
                    description: 'Conservative Bayesian design with overdose protection.'
                },
                'blrm': {
                    title: 'BLRM - Bayesian Logistic Regression',
                    description: 'Uses logistic regression for dose-toxicity modeling.'
                },
                'mTPI': {
                    title: 'mTPI - Modified Toxicity Probability Interval',
                    description: 'Improved interval design with better properties than BOIN.'
                }
            };
            
            const info = designDescriptions[designType];
            infoBox.innerHTML = `<h4>${info.title}</h4><p>${info.description}</p>`;
        }
        
        function loadPreset(module) {
            if (module === 'pbpk') {
                document.getElementById('drug-name').value = 'Example Drug X';
                document.getElementById('target-protein').value = 'Target Receptor Y';
                document.getElementById('bioavailability').value = 85;
                document.getElementById('ka').value = 1.2;
                document.getElementById('vd').value = 65;
                document.getElementById('clearance').value = 1.0;
                document.getElementById('protein-binding').value = 92;
                document.getElementById('ec50').value = 45;
                document.getElementById('hill').value = 1.4;
                
                alert('Loaded example: Typical oral small molecule drug parameters');
                runPBPKSimulation();
            }
        }
        
        function startTutorial(tutorialType) {
            const contentDiv = document.getElementById('tutorial-content');
            
            const tutorials = {
                'publication-guide': {
                    title: 'How to Publish Your Findings',
                    content: `
                        <h3>Publishing Research on PharmaSim Pro</h3>
                        <div class="info-box">
                            <h4>Step-by-Step Guide</h4>
                            <ol style="margin: 10px 0; padding-left: 20px; line-height: 1.8;">
                                <li><strong>Run Your Simulation:</strong> Complete your PBPK, clinical trial, or molecular dynamics analysis</li>
                                <li><strong>Capture Results:</strong> Click the "📊 Capture for Publication" button in any module</li>
                                <li><strong>Navigate to Publications:</strong> Click the "Research Publications" tab</li>
                                <li><strong>Fill in Details:</strong> Enter your drug name, target protein, and key findings</li>
                                <li><strong>Add Data:</strong> Include your quantitative results and parameters</li>
                                <li><strong>Describe Implications:</strong> Explain what this means for future research</li>
                                <li><strong>Preview & Publish:</strong> Review your publication and click "Publish Findings"</li>
                            </ol>
                        </div>
                        <div class="educational-tip">
                            <strong>Best Practices:</strong><br>
                            • Be specific about your methods and parameters<br>
                            • Include all relevant numerical data<br>
                            • Discuss limitations of the computational approach<br>
                            • Suggest experimental validation steps<br>
                            • Cite PharmaSim Pro and the creator properly
                        </div>
                    `
                },
                'pbpk-basics': {
                    title: 'PBPK Basics Tutorial',
                    content: `
                        <h3>Understanding PBPK Models</h3>
                        <div class="info-box">
                            <h4>What is PBPK?</h4>
                            <p>Physiologically-Based Pharmacokinetic modeling predicts drug concentrations in different body tissues over time.</p>
                        </div>
                        <div class="educational-tip">
                            <strong>Key Parameters:</strong>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li><strong>Clearance (CL):</strong> How fast the body removes the drug</li>
                                <li><strong>Volume of Distribution (Vd):</strong> How widely the drug spreads in the body</li>
                                <li><strong>Bioavailability (F):</strong> Fraction reaching systemic circulation</li>
                                <li><strong>Half-life:</strong> Time for concentration to drop by 50%</li>
                            </ul>
                        </div>
                        <button onclick="switchModule('pbpk')">Try PBPK Module</button>
                    `
                },
                'trial-designs': {
                    title: 'Clinical Trial Designs',
                    content: `
                        <h3>Phase 1 Trial Designs Explained</h3>
                        <div class="info-box">
                            <h4>Traditional vs Modern Designs</h4>
                            <p>Modern Bayesian designs find the MTD faster with fewer patients than traditional 3+3.</p>
                        </div>
                        <table style="width: 100%; margin: 20px 0; border-collapse: collapse;">
                            <tr>
                                <th style="text-align: left; padding: 10px; border-bottom: 2px solid #ddd;">Design</th>
                                <th style="text-align: left; padding: 10px; border-bottom: 2px solid #ddd;">Efficiency</th>
                                <th style="text-align: left; padding: 10px; border-bottom: 2px solid #ddd;">Best Use</th>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">3+3</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">Low</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">Simple, small trials</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">CRM</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">High</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">Model-based optimization</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">BOIN</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">Medium-High</td>
                                <td style="padding: 10px; border-bottom: 1px solid #eee;">Balance of simplicity and efficiency</td>
                            </tr>
                        </table>
                        <button onclick="switchModule('clinical')">Explore Trial Designs</button>
                    `
                },
                'molecular-intro': {
                    title: 'Molecular Simulations 101',
                    content: `
                        <h3>Introduction to Molecular Dynamics</h3>
                        <div class="info-box">
                            <h4>Key Concepts</h4>
                            <p>Molecular dynamics simulations predict how drugs interact with proteins at the atomic level.</p>
                        </div>
                        <div class="educational-tip">
                            <strong>Important Metrics:</strong>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li><strong>Binding Affinity:</strong> How strongly the drug binds to the target</li>
                                <li><strong>RMSD:</strong> Root mean square deviation - structural stability</li>
                                <li><strong>Hydrogen Bonds:</strong> Key interactions for binding</li>
                                <li><strong>SASA:</strong> Solvent accessible surface area</li>
                            </ul>
                        </div>
                        <button onclick="switchModule('molecular')">Try Molecular Dynamics</button>
                    `
                },
                'case-study': {
                    title: 'Complete Case Study',
                    content: `
                        <h3>Integrated Drug Development Case Study</h3>
                        <div class="info-box">
                            <h4>Novel Kinase Inhibitor Development</h4>
                            <p>Follow the complete journey from molecular design to clinical trial planning.</p>
                        </div>
                        <div style="background: #f8f9fa; padding: 20px; border-radius: 10px; margin: 20px 0;">
                            <h4>Step 1: Molecular Analysis</h4>
                            <p>Load the SMILES structure and analyze binding to target kinase</p>
                            
                            <h4>Step 2: PBPK Modeling</h4>
                            <p>Predict pharmacokinetic properties and optimize dosing</p>
                            
                            <h4>Step 3: Trial Design</h4>
                            <p>Select optimal Phase 1 dose escalation strategy</p>
                            
                            <h4>Step 4: Publication</h4>
                            <p>Document and share findings with the research community</p>
                        </div>
                        <button onclick="alert('Case study walkthrough would start here with guided steps through each module')">Start Guided Case Study</button>
                    `
                }
            };
            
            const tutorial = tutorials[tutorialType];
            if (tutorial) {
                contentDiv.innerHTML = tutorial.content;
            } else {
                contentDiv.innerHTML = '<h3>Tutorial not found</h3><p>Please select a valid tutorial from the menu.</p>';
            }
        }
        
        // Molecular dynamics functions
        function loadMolecularStructure() {
            const smilesInput = document.getElementById('smilesInput').value;
            const pdbFile = document.getElementById('pdbFile').files[0];
            const displayDiv = document.getElementById('molecularDisplay');
            displayDiv.innerHTML = ''; // Clear previous content

            if (pdbFile) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const pdbData = event.target.result;
                    if (viewer) {
                        viewer.clear();
                    }
                    viewer = $3Dmol.createViewer(displayDiv);
                    viewer.addModel(pdbData, "pdb");
                    viewer.setStyle({}, {stick: {}});
                    viewer.zoomTo();
                    viewer.render();
                };
                reader.readAsText(pdbFile);
            } else if (smilesInput && rdkit) {
                const mol = rdkit.get_mol(smilesInput);
                if (mol) {
                    const svg = mol.get_svg();
                    displayDiv.innerHTML = svg;
                } else {
                    displayDiv.innerHTML = '<p style="color: red; text-align: center; padding-top: 50px;">Invalid SMILES string</p>';
                }
                mol?.delete();
            } else {
                 displayDiv.innerHTML = '<p style="color: #555; text-align: center; padding-top: 50px;">Please upload a PDB file or enter a SMILES string.</p>';
            }
        }
        
        function startMolecularSimulation() {
            showLoading();
            
            setTimeout(() => {
                // Simulate some molecular dynamics results
                document.getElementById('total-energy').textContent = '-1234.5 kJ/mol';
                document.getElementById('binding-affinity').textContent = '-8.7 kcal/mol';
                document.getElementById('rmsd').textContent = '2.1 Å';
                document.getElementById('hbonds').textContent = '4';
                document.getElementById('rg').textContent = '18.3 Å';
                document.getElementById('sasa').textContent = '142.5 Å²';
                
                alert('Molecular dynamics simulation completed!');
                hideLoading();
            }, 2000);
        }
        
        function stopMolecularSimulation() {
            alert('Simulation stopped.');
        }
        
        function exportMolecularData() {
            const data = {
                totalEnergy: document.getElementById('total-energy').textContent,
                bindingAffinity: document.getElementById('binding-affinity').textContent,
                rmsd: document.getElementById('rmsd').textContent,
                hbonds: document.getElementById('hbonds').textContent,
                rg: document.getElementById('rg').textContent,
                sasa: document.getElementById('sasa').textContent
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'molecular_dynamics_results.json';
            link.click();
        }
        
        // Show disclaimer
        function showDisclaimer() {
            alert(`
COMPREHENSIVE DISCLAIMER

PharmaSim Pro provides computational models for educational and exploratory research purposes only.

IMPORTANT LIMITATIONS:
• All values are theoretical estimates based on simplified mathematical models
• Results have NOT been validated experimentally
• Models can produce errors and inaccuracies
• Not suitable for clinical decision-making
• Not FDA-approved or validated for drug development decisions

REQUIRED VALIDATION:
• All computational predictions MUST be validated through:
  - In vitro experiments
  - In vivo studies
  - Additional in silico modeling with validated software
  - Peer review and replication

PROFESSIONAL CONSULTATION:
• Always consult qualified professionals before making research or clinical decisions
• Double-check all calculations independently
• Verify results with established software packages

SOURCE CODE:
• Available on GitHub for transparency and peer review
• Community contributions and corrections welcome

By using this platform, you acknowledge these limitations and agree to use results responsibly.

Created by David Ferguson, BS, MS, Pharm.D. Candidate
Powered by Anthropic Claude AI
            `);
        }
        
        // Show about
        function showAbout() {
            alert(`
ABOUT PHARMASIM PRO

PharmaSim Pro is an integrated pharmaceutical research platform designed for pharmacy students and early-career scientists.

FEATURES:
• PBPK/QSP Modeling
• Bayesian Clinical Trial Design (6 different methods)
• Molecular Dynamics Simulations
• Research Publication System

CREATOR:
David Ferguson, BS, MS, Pharm.D. Candidate

TECHNOLOGY:
Powered by Anthropic Claude AI
Built with modern web technologies
Open source and transparent

MISSION:
To democratize access to pharmaceutical modeling tools and accelerate drug discovery education.

VERSION: 1.0.0
Released: January 2025

For questions or contributions, visit our GitHub repository.
            `);
        }
        
        // Show citation info
        function showCitation() {
            alert(`
HOW TO CITE PHARMASIM PRO

For academic publications:
Ferguson, D. (2025). PharmaSim Pro: Integrated Pharmaceutical Research Platform [Computer software]. 
Powered by Anthropic Claude AI. Available at: https://github.com/pharmasim-pro

BibTeX:
@software{ferguson2025pharmasim,
  author = {Ferguson, David},
  title = {PharmaSim Pro: Integrated Pharmaceutical Research Platform},
  year = {2025},
  note = {Powered by Anthropic Claude AI},
  url = {https://github.com/pharmasim-pro}
}

For research using specific modules:
• PBPK Module: "PBPK modeling performed using PharmaSim Pro (Ferguson, 2025)"
• Clinical Trials: "Trial simulations conducted with PharmaSim Pro (Ferguson, 2025)"
• Molecular Dynamics: "MD simulations visualized using PharmaSim Pro (Ferguson, 2025)"

Always include the disclaimer about computational estimates requiring validation.
            `);
        }
        
        // Helper functions
        function showLoading() {
            document.getElementById('loadingOverlay').style.display = 'flex';
        }
        
        function hideLoading() {
            document.getElementById('loadingOverlay').style.display = 'none';
        }
        
        // Initialize on load
        window.onload = function() {
            initializeCharts();
            updateDesignInfo();
            
            // Add input listeners for range sliders
            document.getElementById('mdTemp').addEventListener('input', function() {
                document.getElementById('mdTempValue').textContent = this.value;
            });
            
            // Show welcome message
            console.log('PharmaSim Pro initialized successfully');
            console.log('Created by David Ferguson, BS, MS, Pharm.D. Candidate');
            console.log('Powered by Anthropic Claude AI');
        };
    </script>
</body>
</html>
